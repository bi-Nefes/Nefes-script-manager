{% extends "base.html" %}

{% block title %}{{ group.name }} - Üyeler{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-users text-primary"></i>
            {{ group.name }} - Üyeler
        </h1>
        <a href="{{ url_for('server_groups') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Gruplara Dön
    </a>
  </div>
  
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                    {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
  
  <div class="row">
    <!-- Mevcut Üyeler -->
        <div class="col-lg-8">
      <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-list"></i> Grup Üyeleri ({{ members|length }})
                    </h6>
        </div>
        <div class="card-body">
                    {% if members %}
                    <div class="table-responsive">
                        <table class="table table-bordered" width="100%" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>Sunucu Adı</th>
                                    <th>Host</th>
                                    <th>OS</th>
                                    <th>Eklenme Tarihi</th>
                                    <th>İşlemler</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for member in members %}
                                <tr>
                                    <td>{{ member.server.name }}</td>
                                    <td>{{ member.server.host }}:{{ member.server.port }}</td>
                                    <td>
                                        <span class="badge bg-{{ 'success' if member.server.os_type == 'linux' else 'primary' }}">
                                            {{ member.server.os_type|title }}
                                        </span>
                                    </td>
                                    <td>{{ member.added_at.strftime('%d.%m.%Y %H:%M') }}</td>
                                    <td>
                  {% if current_user.has_permission('edit_server') %}
                                        <form action="{{ url_for('remove_server_from_group', group_id=group.id, server_id=member.server.id) }}" method="post" style="display: inline;">
                                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Bu sunucuyu gruptan çıkarmak istediğinizden emin misiniz?')">
                                                <i class="fas fa-user-minus"></i> Çıkar
                    </button>
                  </form>
                  {% endif %}
                                    </td>
                                </tr>
              {% endfor %}
                            </tbody>
                        </table>
            </div>
          {% else %}
            <div class="text-center py-4">
                        <i class="fas fa-users fa-2x text-gray-300 mb-3"></i>
                        <h5 class="text-gray-500">Henüz üye yok</h5>
                        <p class="text-gray-400">Bu gruba sunucu eklemek için sağ taraftaki paneli kullanın.</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
    
    <!-- Sunucu Ekleme -->
        <div class="col-lg-4">
      <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-plus"></i> Sunucu Ekle
                    </h6>
        </div>
        <div class="card-body">
                    {% if available_servers %}
                    <form action="{{ url_for('add_server_to_group', group_id=group.id) }}" method="post">
                        <div class="mb-3">
                            <label for="server_id" class="form-label">Sunucu Seçin</label>
                            <select class="form-select" id="server_id" name="server_id" required>
                                <option value="">Sunucu seçin...</option>
                                {% for server in available_servers %}
                                <option value="{{ server.id }}">{{ server.name }} ({{ server.host }})</option>
                                {% endfor %}
                            </select>
                    </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-user-plus"></i> Gruba Ekle
                      </button>
                    </form>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-check-circle fa-2x text-success mb-3"></i>
                        <h5 class="text-success">Tüm sunucular grupta!</h5>
                        <p class="text-gray-400">Eklenebilecek başka sunucu kalmadı.</p>
                    </div>
                    {% endif %}
                  </div>
            </div>

            <!-- Grup Bilgileri -->
            <div class="card shadow mt-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-info-circle"></i> Grup Bilgileri
                    </h6>
            </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-4">Grup Adı:</dt>
                        <dd class="col-sm-8">{{ group.name }}</dd>
                        
                        <dt class="col-sm-4">Üye Sayısı:</dt>
                        <dd class="col-sm-8">{{ members|length }}</dd>
                        
                        <dt class="col-sm-4">Oluşturulma:</dt>
                        <dd class="col-sm-8">{{ group.created_at.strftime('%d.%m.%Y') }}</dd>
                        
                        {% if group.description %}
                        <dt class="col-sm-4">Açıklama:</dt>
                        <dd class="col-sm-8">{{ group.description }}</dd>
          {% endif %}
                    </dl>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 